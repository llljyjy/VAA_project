---
title: "Data Preperation"
author: "Li Jiayi"
date: "02/22/24"
date-modified: "last-modified"
execute:
  eval: true
  echo: true 
  warning: false
date-format: long
---

```{r}
pacman::p_load(ggrepel, patchwork, 
               ggthemes, hrbrthemes,
               ggdist, ggridges,
               colorspace,ggstatsplot, 
               tidyverse) 
```

import big mac data

```{r}
big_mac <- read_csv("../../data/big_mac.csv")
```

```{r}
head(big_mac)
```

check number of records per year

```{r}
big_mac$date <- as.Date(big_mac$date)
big_mac$year <- year(big_mac$date)

entries_per_year_country <- big_mac %>%
  group_by(year, name) %>%
  summarize(count = n())
```

As most countries only contains 1 record each year, the earliest record for each year will be kept for easier manipulation

```{r}
first_records <- big_mac %>%
  group_by(year, name) %>%
  slice(1)
```

only keep name, rename as country, **currency_code, local_price, dollar_ex rename to usd_price, year**

```{r}
big_mac_new <- first_records %>%
  select(
    country = name, 
    currency_code, 
    local_price, 
    usd_price = dollar_ex, 
    year
  )
```

some of country name is not consistent, rename

```{r}
big_mac_new <- big_mac_new %>%
  mutate(country = case_when(
    country == 'United Arab Emirates' ~ 'UAE',
    TRUE ~ country  
  ))
```

add in export & import data

```{r}
export <- read_csv("../../data/export.csv")
```

```{r}
head(export)
```

rename export column and filter important columns for joining

```{r}
export_data <- rename(export, country = `Partner Name`, year = Year) %>%
  select(country, 
         year,
         export_usd = `Export (US$ Thousand)`,
         import_usd = `Import (US$ Thousand)`)

```

rename some of the country and location name

```{r}
export_data <- export_data %>%
  mutate(country = case_when(
    country == "Russian Federation" ~ "Russia",
    country == "United Kingdom" ~ "Britain",
    country == "Hong Kong, China" ~ "Hong Kong",
    country == "Korea, Rep." ~ "South Korea",
    country == 'Egypt, Arab Rep.' ~ 'Egypt',
    country == 'Slovak Republic' ~ 'Slovakia',
    country == 'United Arab Emirates' ~ 'UAE',
    TRUE ~ country  
  ))
```

join the big mac data with export data

```{r}
joined_data <- left_join(big_mac_new, export_data, by = c("country", "year"))
```

add in gdp data

```{r}
gdp <- read_csv("../../data/gdp.csv")
```

```{r}
head(gdp)
```

reformat to long format

```{r}
gdp_long_format <- gdp %>%
  pivot_longer(
    cols = -c(`Series Name`, `Series Code`, `Country Name`, `Country Code`),  
    names_to = "year",
    names_pattern = "^\\d{4} \\[YR(\\d{4})\\]",  
    values_to = "GDP"
  ) %>%
  select(country = `Country Name`, year, GDP)

gdp_long_format$year <- as.integer(gdp_long_format$year)
```

convert missing data

```{r}
gdp_long_format <- gdp_long_format %>%
  mutate(GDP = na_if(GDP, ".."))
```

rename columns in GDP

```{r}
gdp_long_format <- gdp_long_format %>%
  mutate(country = case_when(
    country == "Russian Federation" ~ "Russia",
    country == "United Kingdom" ~ "Britain",
    country == "Czechia" ~ "Czech Republic",
    country == "Korea, Rep." ~ "South Korea",
    country == "Egypt, Arab Rep." ~ "Egypt",
    country == 'Hong Kong SAR, China' ~ 'Hong Kong',
    country == 'Slovak Republic' ~ 'Slovakia',
    country == 'United Arab Emirates' ~ 'UAE',
    country == 'Viet Nam' ~ 'Vietnam',
    country == 'Turkiye' ~ 'Turkey',
    country == 'Venezuela, RB' ~ 'Venezuela',
    TRUE ~ country  
  ))
```

join big mac data with gdp

```{r}
joined_data <- left_join(joined_data, gdp_long_format, by = c("country", "year"))
```

import GPD per Capita data

```{r}
gdp_capita <- read_csv("../../data/gdp_capita.csv")
```

```{r}
head(gdp_capita)
```

reformat to long format

```{r}
gdp_capita_long_format <- gdp_capita %>%
  pivot_longer(
    cols = -c(`Series Name`, `Series Code`, `Country Name`, `Country Code`),  
    names_to = "year",
    names_pattern = "^\\d{4} \\[YR(\\d{4})\\]",  
    values_to = "gdp_per_capita"
  ) %>%
  select(country = `Country Name`, year, gdp_per_capita)

gdp_capita_long_format$year <- as.integer(gdp_capita_long_format$year)
```

convert missing data

```{r}
gdp_capita_long_format <- gdp_capita_long_format %>%
  mutate(gdp_per_capita = na_if(gdp_per_capita, ".."))
```

rename columns in inflation

```{r}
gdp_capita_long_format <- gdp_capita_long_format %>%
  mutate(country = case_when(
    country == "Russian Federation" ~ "Russia",
    country == "United Kingdom" ~ "Britain",
    country == "Czechia" ~ "Czech Republic",
    country == "Korea, Rep." ~ "South Korea",
    country == "Egypt, Arab Rep." ~ "Egypt",
    country == 'Hong Kong SAR, China' ~ 'Hong Kong',
    country == 'Slovak Republic' ~ 'Slovakia',
    country == 'United Arab Emirates' ~ 'UAE',
    country == 'Viet Nam' ~ 'Vietnam',
    country == 'Turkiye' ~ 'Turkey',
    country == 'Venezuela, RB' ~ 'Venezuela',
    TRUE ~ country  
  ))
```

join big mac data with gdp_per_capita

```{r}
joined_data <- left_join(joined_data, gdp_capita_long_format, by = c("country", "year"))
```

import GPD per emploed data

```{r}
gdp_employed <- read_csv("../../data/gdp_employed.csv")
```

```{r}
head(gdp_employed)
```

reformat to long format

```{r}
gdp_employed_long_format <- gdp_employed %>%
  pivot_longer(
    cols = -c(`Series Name`, `Series Code`, `Country Name`, `Country Code`),  
    names_to = "year",
    names_pattern = "^\\d{4} \\[YR(\\d{4})\\]",  
    values_to = "gdp_per_employed"
  ) %>%
  select(country = `Country Name`, year, gdp_per_employed)

gdp_employed_long_format$year <- as.integer(gdp_employed_long_format$year)
```

convert missing data

```{r}
gdp_employed_long_format <- gdp_employed_long_format %>%
  mutate(gdp_per_employed = na_if(gdp_per_employed, ".."))
```

rename columns in inflation

```{r}
gdp_employed_long_format <- gdp_employed_long_format %>%
  mutate(country = case_when(
    country == "Russian Federation" ~ "Russia",
    country == "United Kingdom" ~ "Britain",
    country == "Czechia" ~ "Czech Republic",
    country == "Korea, Rep." ~ "South Korea",
    country == "Egypt, Arab Rep." ~ "Egypt",
    country == 'Hong Kong SAR, China' ~ 'Hong Kong',
    country == 'Slovak Republic' ~ 'Slovakia',
    country == 'United Arab Emirates' ~ 'UAE',
    country == 'Viet Nam' ~ 'Vietnam',
    country == 'Turkiye' ~ 'Turkey',
    country == 'Venezuela, RB' ~ 'Venezuela',
    TRUE ~ country  
  ))
```

join big mac data with gdp_per_employed

```{r}
joined_data <- left_join(joined_data, gdp_employed_long_format, by = c("country", "year"))
```

import inflation data

```{r}
inflation <- read_csv("../../data/inflation.csv")
```

```{r}
head(inflation)
```

reformat to long format

```{r}
inflation_long_format <- inflation %>%
  pivot_longer(
    cols = -c(`Series Name`, `Series Code`, `Country Name`, `Country Code`),  
    names_to = "year",
    names_pattern = "^\\d{4} \\[YR(\\d{4})\\]",  
    values_to = "inflation"
  ) %>%
  select(country = `Country Name`, year, inflation)

inflation_long_format$year <- as.integer(inflation_long_format$year)
```

convert missing data

```{r}
inflation_long_format <- inflation_long_format %>%
  mutate(inflation = na_if(inflation, ".."))
```

rename columns in inflation

```{r}
inflation_long_format <- inflation_long_format %>%
  mutate(country = case_when(
    country == "Russian Federation" ~ "Russia",
    country == "United Kingdom" ~ "Britain",
    country == "Czechia" ~ "Czech Republic",
    country == "Korea, Rep." ~ "South Korea",
    country == "Egypt, Arab Rep." ~ "Egypt",
    country == 'Hong Kong SAR, China' ~ 'Hong Kong',
    country == 'Slovak Republic' ~ 'Slovakia',
    country == 'United Arab Emirates' ~ 'UAE',
    country == 'Viet Nam' ~ 'Vietnam',
    country == 'Turkiye' ~ 'Turkey',
    country == 'Venezuela, RB' ~ 'Venezuela',
    TRUE ~ country  
  ))
```

join big mac data with inflation

```{r}
joined_data <- left_join(joined_data, inflation_long_format, by = c("country", "year"))
```

drop Taiwan, and EuroÂ area, and rename the new dataframe

```{r}
big_mac_combined <- joined_data %>%
  filter(country != "Taiwan", country != "Euro area")
```

take a look at the dataframe

```{r}
head(big_mac_combined)
```

change column datatype

```{r}
big_mac_combined <- big_mac_combined %>%
  mutate(
    GDP = as.numeric(GDP),
    inflation = as.numeric(inflation),
    gdp_per_capita = as.numeric(gdp_per_capita),
    gdp_per_employed = as.numeric(gdp_per_employed)
  )
```

```{r}
head(big_mac_combined)
```

```{r}
summary(big_mac_combined)
```
